const { SlashCommandBuilder, AttachmentBuilder } = require('discord.js');
const eventBracket = require('../../Scripts/Eventbracket');
const bracketRenderer = require('../../Scripts/BracketRenderer');
const db = require('../../database/database');

module.exports = {
    data: new SlashCommandBuilder()
        .setName('event-match')
        .setDescription('Atualiza uma partida')
        .addStringOption(o => o.setName('winner').setDescription('Vencedor').setRequired(true))
        .addStringOption(o => o.setName('loser').setDescription('Perdedor').setRequired(true)),

    async execute(interaction) {
        const winner = interaction.options.getString('winner');
        const loser = interaction.options.getString('loser');

        const bracket = eventBracket.advanceWinner(winner, loser);
        if (!bracket) return interaction.reply('Nenhum torneio ativo.');

        const buffer = await bracketRenderer.render(bracket);
        await interaction.reply({
            content: `${winner} avan√ßa${bracket.hasLower ? ` e ${loser} vai para a chave inferior` : ''}!`,
            files: [new AttachmentBuilder(buffer, { name: 'updated_bracket.png' })]
        });
    }
};
